# Survey API

FastAPI-based API for managing survey **versions**, **questions**, and **responses**.

## Features
- Layered architecture: `api/`, `domain/`, `services/`, `repositories/`, `db/`, `migrations/`
- SQLAlchemy + Alembic, IDs generated by the DB (INTEGER, autoincrement)
- Pydantic schemas separated from ORM models
- Config via `.env` using `pydantic.BaseSettings`
- Basic i18n via `domain/messages.py` (Enum)

## Quickstart

1. **Clone & env**
   ```bash
   python -m venv venv
   source venv/bin/activate  # Windows: venv\Scripts\activate
   pip install -r requirements.txt
   cp .env .env.local || true
   ```
   Fill `.env`:
   ```env
   DATABASE_URL=postgresql://postgres:password@localhost:5432/survey_db
   # For quick demo you can use sqlite:
   # DATABASE_URL=sqlite:///./survey.db
   ```

2. **DB & migrations (Alembic)**
   ```bash
   alembic upgrade head
   ```

3. **Run API**
   ```bash
   uvicorn main:app --reload
   ```

## Example requests

### Versions
```bash
curl -X POST http://localhost:8000/versions/ -H "Content-Type: application/json" -d '{"name":"v1"}'
curl http://localhost:8000/versions/
curl -X PUT http://localhost:8000/versions/1 -H "Content-Type: application/json" -d '{"name":"v1.1"}'
curl -X DELETE http://localhost:8000/versions/1
```

### Questions
```bash
curl -X POST http://localhost:8000/questions/ -H "Content-Type: application/json" -d '{"version_id":1,"number":"1.1","text":"Ваш вопрос?","type":"text"}'
curl "http://localhost:8000/questions/?version_id=1"
curl -X PUT http://localhost:8000/questions/1 -H "Content-Type: application/json" -d '{"text":"Обновлённый вопрос?"}'
curl -X DELETE http://localhost:8000/questions/1
```

### Responses
```bash
curl -X POST http://localhost:8000/responses/ -H "Content-Type: application/json" -d '{"user_id":42,"version_id":1,"question_id":1,"response_value":"Да"}'
curl "http://localhost:8000/responses/?user_id=42&version_id=1"
curl -X PUT http://localhost:8000/responses/1 -H "Content-Type: application/json" -d '{"response_value":"Нет"}'
curl -X DELETE http://localhost:8000/responses/1
```

## Project structure
```text
api/           # FastAPI routers
domain/        # ORM models, Pydantic schemas, enums
services/      # Business logic
repositories/  # DB access layer
db/            # engine, session, settings
migrations/    # Alembic migrations
tests/         # pytest tests
```
